var O=s=>{throw TypeError(s)};var q=(s,t,e)=>t.has(s)||O("Cannot "+e);var a=(s,t,e)=>(q(s,t,"read from private field"),e?e.call(s):t.get(s)),d=(s,t,e)=>t.has(s)?O("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),l=(s,t,e,i)=>(q(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e),f=(s,t,e)=>(q(s,t,"access private method"),e);import{R as P,h as H,n as T,r as Q,C as x,t as N,D as Y,j as L,v as W,E as A,F as _}from"./fetch-utils-CEdl9sdl.js";var b,D,u,v,n,F,m,c,p,k,X=(k=class extends P{constructor(t){super();d(this,c);d(this,b);d(this,D);d(this,u);d(this,v);d(this,n);d(this,F);d(this,m);l(this,m,!1),l(this,F,t.defaultOptions),this.setOptions(t.options),this.observers=[],l(this,v,t.client),l(this,u,a(this,v).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,l(this,b,B(this.options)),this.state=t.state??a(this,b),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=a(this,n))==null?void 0:t.promise}setOptions(t){this.options={...a(this,F),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&a(this,u).remove(this)}setData(t,e){const i=H(this.state.data,t,this.options);return f(this,c,p).call(this,{data:i,type:"success",dataUpdatedAt:e==null?void 0:e.updatedAt,manual:e==null?void 0:e.manual}),i}setState(t,e){f(this,c,p).call(this,{type:"setState",state:t,setStateOptions:e})}cancel(t){var i,h;const e=(i=a(this,n))==null?void 0:i.promise;return(h=a(this,n))==null||h.cancel(t),e?e.then(T).catch(T):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(a(this,b))}isActive(){return this.observers.some(t=>Q(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===x||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(t=0){return this.state.isInvalidated||this.state.data===void 0||!N(this.state.dataUpdatedAt,t)}onFocus(){var e;const t=this.observers.find(i=>i.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(e=a(this,n))==null||e.continue()}onOnline(){var e;const t=this.observers.find(i=>i.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(e=a(this,n))==null||e.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),a(this,u).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(a(this,n)&&(a(this,m)?a(this,n).cancel({revert:!0}):a(this,n).cancelRetry()),this.scheduleGc()),a(this,u).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||f(this,c,p).call(this,{type:"invalidate"})}fetch(t,e){var w,M,I;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(e!=null&&e.cancelRefetch))this.cancel({silent:!0});else if(a(this,n))return a(this,n).continueRetry(),a(this,n).promise}if(t&&this.setOptions(t),!this.options.queryFn){const r=this.observers.find(o=>o.options.queryFn);r&&this.setOptions(r.options)}const i=new AbortController,h=r=>{Object.defineProperty(r,"signal",{enumerable:!0,get:()=>(l(this,m,!0),i.signal)})},U=()=>{const r=W(this.options,e),o={client:a(this,v),queryKey:this.queryKey,meta:this.meta};return h(o),l(this,m,!1),this.options.persister?this.options.persister(r,o,this):r(o)},y={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:a(this,v),state:this.state,fetchFn:U};h(y),(w=this.options.behavior)==null||w.onFetch(y,this),l(this,D,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((M=y.fetchOptions)==null?void 0:M.meta))&&f(this,c,p).call(this,{type:"fetch",meta:(I=y.fetchOptions)==null?void 0:I.meta});const R=r=>{var o,S,g,C;A(r)&&r.silent||f(this,c,p).call(this,{type:"error",error:r}),A(r)||((S=(o=a(this,u).config).onError)==null||S.call(o,r,this),(C=(g=a(this,u).config).onSettled)==null||C.call(g,this.state.data,r,this)),this.scheduleGc()};return l(this,n,Y({initialPromise:e==null?void 0:e.initialPromise,fn:y.fetchFn,abort:i.abort.bind(i),onSuccess:r=>{var o,S,g,C;if(r===void 0){R(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(r)}catch(K){R(K);return}(S=(o=a(this,u).config).onSuccess)==null||S.call(o,r,this),(C=(g=a(this,u).config).onSettled)==null||C.call(g,r,this.state.error,this),this.scheduleGc()},onError:R,onFail:(r,o)=>{f(this,c,p).call(this,{type:"failed",failureCount:r,error:o})},onPause:()=>{f(this,c,p).call(this,{type:"pause"})},onContinue:()=>{f(this,c,p).call(this,{type:"continue"})},retry:y.options.retry,retryDelay:y.options.retryDelay,networkMode:y.options.networkMode,canRun:()=>!0})),a(this,n).start()}},b=new WeakMap,D=new WeakMap,u=new WeakMap,v=new WeakMap,n=new WeakMap,F=new WeakMap,m=new WeakMap,c=new WeakSet,p=function(t){const e=i=>{switch(t.type){case"failed":return{...i,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...z(i.data,this.options),fetchMeta:t.meta??null};case"success":return{...i,data:t.data,dataUpdateCount:i.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const h=t.error;return A(h)&&h.revert&&a(this,D)?{...a(this,D),fetchStatus:"idle"}:{...i,error:h,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:h,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...t.state}}};this.state=e(this.state),L.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),a(this,u).notify({query:this,type:"updated",action:t})})},k);function z(s,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:_(t.networkMode)?"fetching":"paused",...s===void 0&&{error:null,status:"pending"}}}function B(s){const t=typeof s.initialData=="function"?s.initialData():s.initialData,e=t!==void 0,i=e?typeof s.initialDataUpdatedAt=="function"?s.initialDataUpdatedAt():s.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:e?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:e?"success":"pending",fetchStatus:"idle"}}function G(s){const t=Object.prototype.toString.call(s);return s instanceof Date||typeof s=="object"&&t==="[object Date]"?new s.constructor(+s):typeof s=="number"||t==="[object Number]"||typeof s=="string"||t==="[object String]"?new Date(s):new Date(NaN)}const Z=6048e5,$=864e5,tt=43200,et=1440;function j(s){const t=G(s);return t.setHours(0,0,0,0),t}function E(s){const t=G(s),e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),+s-+e}function st(s,t){const e=j(s),i=j(t),h=+e-E(e),U=+i-E(i);return Math.round((h-U)/$)}export{X as Q,et as a,tt as b,st as d,z as f,E as g,Z as m,j as s,G as t};
