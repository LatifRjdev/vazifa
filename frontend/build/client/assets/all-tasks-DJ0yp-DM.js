import{w as oe}from"./with-props-DyG_vBPJ.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{t as ne,a as m,q as de}from"./chunk-D4RADZKF-By21buN-.js";import{L as ce}from"./loader-B2rr_xqw.js";import{u as me}from"./language-context-DQqIPPDP.js";import{B as H}from"./badge-BR4L36Rg.js";import{B as D}from"./button-CYnDp3Q-.js";import{C as j,a as f,b as p,d as g}from"./card-DunmZ-Mm.js";import{c as V}from"./utils-DIzSUSji.js";import{I as xe}from"./input-BPm_T_uW.js";import{S as T,a as A,b as P,c as F,d as l}from"./select-CDLpyc4Q.js";import{S as he,T as ue,a as je,b as M,c as h,d as fe,e as x}from"./table-DP2a9-SM.js";import{A as pe,a as ge,b as _e}from"./avatar-B8lmOvvi.js";import{g as $,f as q,b as Ne,a as G,C as U}from"./date-filters-lJ-rVYS_.js";import{P as J,a as K,b as X,r as L}from"./popover-Ct-mlSgl.js";import{a as ve,f as we}from"./date-utils-BYRQ6yq9.js";import{g as ye,a as be}from"./translations-D806p-9r.js";import{u as ke}from"./auth-context-B5vrc64i.js";import{c as Ce}from"./use-task-ClqRGOoq.js";import{C as De}from"./circle-alert-CzTjZiAb.js";import{C as Y}from"./calendar-Dcbq6X4X.js";import{A as Se,a as Te}from"./arrow-up-narrow-wide-DEjoBurv.js";import{E as Ae}from"./eye-BcJvAFHL.js";import{f as Z}from"./DayPicker-B79OQGaG.js";import"./index-CnVBUu3y.js";import"./index-BdQq_4o_.js";import"./index-wu72o1Zw.js";import"./index-BIYj4ebj.js";import"./index-DTIwNWd2.js";import"./index-BhFca_hj.js";import"./Combination-BUzufNIs.js";import"./createLucideIcon-DYOGCEiU.js";import"./endOfMonth-B9jd4p3w.js";import"./differenceInCalendarDays-D7TXt3rl.js";import"./fetch-utils-CEdl9sdl.js";import"./en-US-DuGUIuVI.js";import"./index-Dspms17g.js";import"./index-CNgNZYQm.js";import"./index-DgMzxt3E.js";import"./useQuery-CkwzADaB.js";import"./useMutation-CUJSGQ7R.js";function _s(){return[{title:"TaskHub | Все задачи"},{name:"description",content:"Управление всеми задачами в TaskHub!"}]}const Pe=()=>{const{t}=me(),{user:a}=ke(),[n,I]=ne(),E=(a==null?void 0:a.role)&&["admin","super_admin","manager"].includes(a.role),[_,ee]=m.useState(n.get("search")||""),[N,se]=m.useState(n.get("status")||"all"),[v,te]=m.useState(n.get("priority")||"all"),[C,ae]=m.useState(n.get("sortBy")||"createdAt"),[w,le]=m.useState(n.get("sortOrder")||"desc"),[o,O]=m.useState(n.get("dateFilter")||"all"),[y,Q]=m.useState(n.get("dateFrom")?new Date(n.get("dateFrom")):void 0),[b,z]=m.useState(n.get("dateTo")?new Date(n.get("dateTo")):void 0),{data:S,isPending:re}=Ce(E);if(m.useEffect(()=>{const s={};_&&(s.search=_),N!=="all"&&(s.status=N),v!=="all"&&(s.priority=v),C!=="createdAt"&&(s.sortBy=C),w!=="desc"&&(s.sortOrder=w),I(s,{replace:!0})},[_,N,v,C,w,I]),!E)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(De,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:t("all_tasks.access_denied")}),e.jsx("p",{className:"text-muted-foreground",children:t("all_tasks.no_access_message")})]})});if(re)return e.jsx(ce,{message:t("all_tasks.loading")});const B=Array.isArray(S==null?void 0:S.tasks)?S.tasks:[];let d=B.filter(s=>{var k;const c=s.title.toLowerCase().includes(_.toLowerCase())||((k=s.description)==null?void 0:k.toLowerCase().includes(_.toLowerCase())),i=N==="all"||s.status===N,r=v==="all"||s.priority===v;return c&&i&&r});if(o!=="all")if(o==="custom"){if(y||b){const s=$("custom",{from:y,to:b});d=q(d,s,"createdAt")}}else{const s=$(o);d=q(d,s,"createdAt")}const R=[...d].sort((s,c)=>{let i,r;switch(C){case"title":i=s.title.toLowerCase(),r=c.title.toLowerCase();break;case"status":i=s.status,r=c.status;break;case"priority":const k={High:3,Medium:2,Low:1};i=k[s.priority]||0,r=k[c.priority]||0;break;case"dueDate":i=s.dueDate?new Date(s.dueDate).getTime():0,r=c.dueDate?new Date(c.dueDate).getTime():0;break;case"createdAt":default:i=new Date(s.createdAt).getTime(),r=new Date(c.createdAt).getTime();break}return w==="asc"?i>r?1:-1:i<r?1:-1}),u={total:B.length,filtered:d.length,todo:d.filter(s=>s.status==="To Do").length,inProgress:d.filter(s=>s.status==="In Progress").length,done:d.filter(s=>s.status==="Done").length,highPriority:d.filter(s=>s.priority==="High").length},ie=o!=="all"?Ne(o):"Все время";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:t("all_tasks.title")}),e.jsx("p",{className:"text-muted-foreground",children:t("all_tasks.description")})]})}),e.jsxs("div",{className:"space-y-4",children:[o!=="all"&&e.jsx("div",{className:"text-center",children:e.jsxs(H,{variant:"outline",className:"text-sm",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),t("all_tasks.statistics_period"),": ",ie]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[e.jsxs(j,{children:[e.jsx(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(p,{className:"text-sm font-medium",children:t(o!=="all"?"all_tasks.for_period":"all_tasks.total_tasks")})}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o!=="all"?u.filtered:u.total}),o!=="all"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t("all_tasks.from_total").replace("{total}",u.total.toString())})]})]}),e.jsxs(j,{children:[e.jsx(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(p,{className:"text-sm font-medium",children:t("status.todo")})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.todo})})]}),e.jsxs(j,{children:[e.jsx(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(p,{className:"text-sm font-medium",children:t("status.in_progress")})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:u.inProgress})})]}),e.jsxs(j,{children:[e.jsx(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(p,{className:"text-sm font-medium",children:t("status.done")})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.done})})]}),e.jsxs(j,{children:[e.jsx(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(p,{className:"text-sm font-medium",children:t("all_tasks.high_priority")})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:u.highPriority})})]})]})]}),e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(p,{children:t("all_tasks.filters_search")})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(xe,{placeholder:t("all_tasks.search_placeholder"),value:_,onChange:s=>ee(s.target.value),className:"pl-10"})]})}),e.jsxs(T,{value:N,onValueChange:se,children:[e.jsx(A,{className:"w-full md:w-48",children:e.jsx(P,{placeholder:t("tasks.task_status")})}),e.jsxs(F,{children:[e.jsx(l,{value:"all",children:t("all_tasks.all_statuses")}),e.jsx(l,{value:"To Do",children:t("status.todo")}),e.jsx(l,{value:"In Progress",children:t("status.in_progress")}),e.jsx(l,{value:"Done",children:t("status.done")})]})]}),e.jsxs(T,{value:v,onValueChange:te,children:[e.jsx(A,{className:"w-full md:w-48",children:e.jsx(P,{placeholder:t("tasks.task_priority")})}),e.jsxs(F,{children:[e.jsx(l,{value:"all",children:t("all_tasks.all_priorities")}),e.jsx(l,{value:"High",children:t("priority.high")}),e.jsx(l,{value:"Medium",children:t("priority.medium")}),e.jsx(l,{value:"Low",children:t("priority.low")})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:t("all_tasks.time_filter")})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs(T,{value:o,onValueChange:s=>O(s),children:[e.jsx(A,{className:"w-full md:w-48",children:e.jsx(P,{placeholder:t("all_tasks.period")})}),e.jsxs(F,{children:[e.jsx(l,{value:"all",children:t("all_tasks.all_time")}),e.jsx(l,{value:"today",children:t("all_tasks.today")}),e.jsx(l,{value:"week",children:t("all_tasks.week")}),e.jsx(l,{value:"month",children:t("all_tasks.month")}),e.jsx(l,{value:"6months",children:t("all_tasks.six_months")}),e.jsx(l,{value:"year",children:t("all_tasks.year")}),e.jsx(l,{value:"custom",children:t("all_tasks.custom_period")})]})]}),o==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsx(K,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:V("w-full md:w-48 justify-start text-left font-normal",!y&&"text-muted-foreground"),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),y?Z(y,"dd.MM.yyyy",{locale:L}):t("all_tasks.date_from")]})}),e.jsx(X,{className:"w-auto p-0",align:"start",children:e.jsx(U,{mode:"single",selected:y,onSelect:Q,initialFocus:!0,locale:L})})]}),e.jsxs(J,{children:[e.jsx(K,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:V("w-full md:w-48 justify-start text-left font-normal",!b&&"text-muted-foreground"),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),b?Z(b,"dd.MM.yyyy",{locale:L}):t("all_tasks.date_to")]})}),e.jsx(X,{className:"w-auto p-0",align:"start",children:e.jsx(U,{mode:"single",selected:b,onSelect:z,initialFocus:!0,locale:L})})]})]}),e.jsx(D,{variant:"outline",onClick:()=>{O("all"),Q(void 0),z(void 0)},className:"w-full md:w-auto",children:t("all_tasks.reset_period")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{value:C,onValueChange:ae,children:[e.jsx(A,{className:"w-48",children:e.jsx(P,{placeholder:t("all_tasks.sort_by")})}),e.jsxs(F,{children:[e.jsx(l,{value:"createdAt",children:t("all_tasks.sort_created")}),e.jsx(l,{value:"title",children:t("all_tasks.sort_title")}),e.jsx(l,{value:"status",children:t("all_tasks.sort_status")}),e.jsx(l,{value:"priority",children:t("all_tasks.sort_priority")}),e.jsx(l,{value:"dueDate",children:t("all_tasks.sort_due_date")})]})]}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>le(w==="asc"?"desc":"asc"),children:w==="asc"?e.jsx(Se,{className:"h-4 w-4"}):e.jsx(Te,{className:"h-4 w-4"})})]})]})]}),e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(p,{children:t("all_tasks.tasks_count").replace("{filtered}",R.length.toString()).replace("{total}",B.length.toString())})}),e.jsx(g,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(ue,{children:[e.jsx(je,{children:e.jsxs(M,{children:[e.jsx(h,{className:"w-16",children:t("all_tasks.table_number")}),e.jsx(h,{children:t("all_tasks.table_title")}),e.jsx(h,{children:t("all_tasks.table_status")}),e.jsx(h,{children:t("all_tasks.table_priority")}),e.jsx(h,{children:t("all_tasks.table_assigned")}),e.jsx(h,{children:t("all_tasks.table_due_date")}),e.jsx(h,{children:t("all_tasks.table_created")}),((a==null?void 0:a.role)==="admin"||(a==null?void 0:a.role)==="manager")&&e.jsx(h,{className:"w-20",children:t("all_tasks.table_actions")})]})}),e.jsxs(fe,{children:[R.map((s,c)=>{var i;return e.jsxs(M,{children:[e.jsx(x,{className:"font-mono text-sm text-muted-foreground",children:c+1}),e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground truncate max-w-xs",children:s.description})]})}),e.jsx(x,{children:e.jsx(H,{variant:s.status.toLowerCase(),children:ye(s.status)})}),e.jsx(x,{children:e.jsx(H,{variant:s.priority==="High"?"destructive":s.priority==="Medium"?"default":"secondary",children:be(s.priority)})}),e.jsx(x,{children:e.jsxs("div",{className:"flex -space-x-2",children:[(i=s.assignees)==null?void 0:i.slice(0,3).map((r,k)=>{var W;return r?e.jsxs(pe,{className:"h-8 w-8 border-2 border-background",children:[e.jsx(ge,{src:r.profilePicture||void 0}),e.jsx(_e,{className:"text-xs",children:((W=r.name)==null?void 0:W.charAt(0))||"?"})]},r._id):null}),s.assignees&&s.assignees.length>3&&e.jsx("div",{className:"h-8 w-8 rounded-full bg-muted border-2 border-background flex items-center justify-center",children:e.jsxs("span",{className:"text-xs",children:["+",s.assignees.length-3]})}),(!s.assignees||s.assignees.length===0)&&e.jsx("span",{className:"text-sm text-muted-foreground",children:t("all_tasks.not_assigned")})]})}),e.jsx(x,{children:s.dueDate?e.jsx("span",{className:V("text-sm",new Date(s.dueDate)<new Date&&s.status!=="Done"?"text-red-600 font-medium":"text-muted-foreground"),children:ve(s.dueDate)}):e.jsx("span",{className:"text-sm text-muted-foreground",children:t("all_tasks.not_specified")})}),e.jsx(x,{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:we(s.createdAt)})}),((a==null?void 0:a.role)==="admin"||(a==null?void 0:a.role)==="manager")&&e.jsx(x,{children:e.jsx(de,{to:`/dashboard/task/${s._id}`,children:e.jsx(D,{variant:"ghost",size:"sm",children:e.jsx(Ae,{className:"h-4 w-4"})})})})]},s._id)}),R.length===0&&e.jsx(M,{children:e.jsx(x,{colSpan:(a==null?void 0:a.role)==="admin"||(a==null?void 0:a.role)==="manager"?8:7,className:"text-center py-8",children:e.jsx("div",{className:"text-muted-foreground",children:t("all_tasks.no_tasks_found")})})})]})]})})})]})]})},Ns=oe(Pe);export{Ns as default,_s as meta};
