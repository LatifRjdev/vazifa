import{w as W}from"./with-props-DyG_vBPJ.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{z as f,u as G,s as K,F as Q,a as N,b as A,c as v,d as S,e as D}from"./form-BmyV6FyK.js";import{b as X}from"./fetch-utils-CEdl9sdl.js";import{a as b,s as Z}from"./chunk-D4RADZKF-By21buN-.js";import{t as i}from"./index-CNgNZYQm.js";import{L as ee}from"./loader-B2rr_xqw.js";import{C as q,a as z,b as H,c as O,d as _}from"./card-DunmZ-Mm.js";import{B as u}from"./button-CYnDp3Q-.js";import{I as g}from"./input-BPm_T_uW.js";import{L as R}from"./label-URIJR8-n.js";import{c as se,d as ae,e as re,f as te,g as ne,h as oe,i as ie,B as le}from"./use-user-TsMmcXVD.js";import{D as ce,a as de,b as me,c as pe,e as ue,d as he}from"./dialog-Bw6wHjQP.js";import{L as $}from"./loader-circle-DPdm6C66.js";import{A as xe,a as fe}from"./alert-DlLWaqXv.js";import{A as je,a as ge,b as be}from"./avatar-B8lmOvvi.js";import{S as we}from"./separator-CWSlA8lv.js";import{u as Pe}from"./auth-context-B5vrc64i.js";import{C as Fe}from"./circle-alert-CzTjZiAb.js";import"./utils-DIzSUSji.js";import"./index-CnVBUu3y.js";import"./index-DTIwNWd2.js";import"./useQuery-CkwzADaB.js";import"./differenceInCalendarDays-D7TXt3rl.js";import"./useMutation-CUJSGQ7R.js";import"./index-wu72o1Zw.js";import"./Combination-BUzufNIs.js";import"./index-Dspms17g.js";import"./createLucideIcon-DYOGCEiU.js";import"./index-DgMzxt3E.js";const Ce=()=>{const[s,n]=b.useState(!1),[l,d]=b.useState(null);return{isOpen:s,confirm:h=>{d(h),n(!0)},handleConfirm:()=>{l==null||l.onConfirm(),n(!1)},handleCancel:()=>{n(!1)},confirmationOptions:l}},ye=({isOpen:s,onConfirm:n,onCancel:l,title:d="Delete Confirmation",message:c,buttonText:r="Confirm"})=>e.jsx(ce,{open:s,onOpenChange:l,children:e.jsxs(de,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:d}),e.jsx(ue,{children:c})]}),e.jsxs(he,{children:[e.jsx(u,{variant:"outline",onClick:l,children:"Отмена"}),e.jsx(u,{variant:"destructive",onClick:n,children:r})]})]})}),Ne=()=>{const[s,n]=b.useState(""),[l,d]=b.useState(!1),{confirm:c,confirmationOptions:r,handleCancel:k,handleConfirm:h,isOpen:U}=Ce(),{data:w,isLoading:m}=se(),{mutate:C,isPending:L}=ae(),{mutate:P,isPending:F}=re(),{mutate:E,isPending:y}=te(),B=async()=>{C({},{onSuccess:()=>{d(!0),i.info("A verification code has been sent to your email.")},onError:t=>{i.error(t.response.data.message),console.log(t)}})},T=async()=>{P({code:s},{onSuccess:()=>{d(!1),n(""),i.success("2FA enabled successfully!")},onError:t=>{i.error(t.response.data.message),console.log(t)}})},M=async()=>{c({title:"Disable 2FA",message:"Are you sure you want to disable 2FA?",onConfirm:async()=>{E({},{onSuccess:()=>{i.success("2FA disabled successfully")},onError:t=>{var o,p;const a=((p=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:p.message)||"Failed to disable 2FA";i.error(a)}})}})};return e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:[e.jsxs(z,{children:[e.jsx(H,{children:"Двухфакторная аутентификация (2FA)"}),e.jsx(O,{children:"Добавьте дополнительный уровень безопасности к своей учетной записи. Если эта функция включена, вам потребуется ввести код,отправленный на вашу электронную почту после входа в систему."})]}),e.jsx(_,{children:m?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Загрузка статуса 2FA..."})]}):w!=null&&w.enabled?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-emerald-600",children:"2FA включена на вашем аккаунте"}),e.jsx(u,{onClick:M,disabled:m||y,variant:"destructive",children:"Отключить 2FA"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-yellow-600",children:"2FA не включена."}),l?e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"otp",children:"Введите код, отправленный на вашу электронную почту"}),e.jsx(g,{id:"otp",type:"text",value:s,onChange:t=>n(t.target.value),placeholder:"6-digit code",maxLength:6,disabled:m||F}),e.jsx(u,{onClick:T,disabled:m||s.length!==6||F,children:"Проверьте и включите"}),e.jsx(u,{type:"button",variant:"ghost",onClick:()=>d(!1),disabled:m||F,children:"Отмена"})]}):e.jsx(u,{onClick:B,disabled:m||L,className:"bg-black text-white",children:"Включить 2FA"})]})})]}),e.jsx(ye,{isOpen:U,onConfirm:h,onCancel:k,title:(r==null?void 0:r.title)||"",message:(r==null?void 0:r.message)||"",buttonText:"Disable 2FA"})]})};function os(){return[{title:"TaskHub | User Profile"},{name:"description",content:"Profile to TaskHub!"}]}const Ae=f.object({currentPassword:f.string().min(1,{message:"Current password is required"}),newPassword:f.string().min(8,{message:"New password is required"}),confirmPassword:f.string().min(8,{message:"Confirm password is required"})}).refine(s=>s.newPassword===s.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]}),ve=f.object({name:f.string().min(1,{message:"Name is required"}),lastName:f.string().optional(),profilePicture:f.string().optional()}),Se=()=>{var t;const{data:s,isPending:n}=ne(),{logout:l}=Pe(),d=Z(),c=G({resolver:K(Ae),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),r=G({resolver:K(ve),defaultValues:{name:(s==null?void 0:s.name)||"",lastName:(s==null?void 0:s.lastName)||"",profilePicture:(s==null?void 0:s.profilePicture)||""},values:{name:(s==null?void 0:s.name)||"",lastName:(s==null?void 0:s.lastName)||"",profilePicture:(s==null?void 0:s.profilePicture)||""}}),{mutate:k,isPending:h}=oe(),{mutate:U,isPending:w,error:m}=ie(),[C,L]=b.useState(null),[P,F]=b.useState(!1),[E,y]=b.useState(0),B=a=>{U(a,{onSuccess:()=>{i.success("Password updated successfully. You will be logged out. Please login again."),c.reset(),setTimeout(()=>{l(),d("/sign-in")},3e3)},onError:o=>{var x,j;const p=((j=(x=o.response)==null?void 0:x.data)==null?void 0:j.error)||"Failed to update password";i.error(p),console.log(o)}})},T=async a=>{var p;const o=((p=a.target.files)==null?void 0:p[0])||null;if(L(o),!!o){if(o.size>1024*1024){i.error("File size must be less than 1MB.");return}F(!0),y(0);try{const x="dlvubqfkj",j="da121806-44c2-4a62-8ca1-5af331bc8d38",Y=`https://api.cloudinary.com/v1_1/${x}/upload`,V=new FormData;V.append("file",o),V.append("upload_preset",j);const J=(await X.post(Y,V,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:I=>{I.total&&y(Math.round(I.loaded*100/I.total))}})).data.secure_url;r.setValue("profilePicture",J),i.success("Avatar uploaded!")}catch{i.error("Upload failed. Please try again.")}finally{F(!1),y(0)}}},M=a=>{k({name:a.name,lastName:a.lastName||"",profilePicture:a.profilePicture||""},{onSuccess:()=>{i.success("Profile updated successfully")},onError:o=>{var x,j;const p=((j=(x=o.response)==null?void 0:x.data)==null?void 0:j.error)||"Failed to update profile";i.error(p),console.log(o)}})};return n?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(ee,{message:"Loading..."})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"px-4 md:px-0",children:[e.jsx(le,{}),e.jsx("h3",{className:"text-lg font-medium",children:"Информация профиля"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Управляйте настройками и предпочтениями своей учетной записи."})]}),e.jsx(we,{}),e.jsxs(q,{children:[e.jsxs(z,{children:[e.jsx(H,{children:"Персональная информация"}),e.jsx(O,{children:"Обновите свои личные данные."})]}),e.jsx(_,{children:e.jsx(Q,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(M),className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsxs(je,{className:"h-20 w-20 bg-gray-600",children:[e.jsx(ge,{src:r.watch("profilePicture")||(s==null?void 0:s.profilePicture),alt:s==null?void 0:s.name}),e.jsx(be,{className:"text-xl",children:((t=s==null?void 0:s.name)==null?void 0:t.charAt(0))||"U"})]}),e.jsxs("div",{children:[e.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:T,disabled:P||h,style:{display:"none"}}),e.jsx(u,{type:"button",size:"sm",variant:"outline",onClick:()=>{var a;return(a=document.getElementById("avatar-upload"))==null?void 0:a.click()},disabled:P||h,children:"Изменить аватар"}),C&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Выбрано:"," ",e.jsx("span",{className:"font-medium",children:C.name})," (",Math.round(C.size/1024)," KB)"]}),P&&e.jsx("div",{className:"w-full bg-muted rounded h-2 mt-2 overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded",style:{width:`${E}%`}})})]})]}),e.jsx(N,{control:r.control,name:"name",render:({field:a})=>e.jsxs(A,{children:[e.jsx(v,{children:"Имя"}),e.jsx(S,{children:e.jsx(g,{...a})}),e.jsx(D,{})]})}),e.jsx(N,{control:r.control,name:"lastName",render:({field:a})=>e.jsxs(A,{children:[e.jsx(v,{children:"Фамилия"}),e.jsx(S,{children:e.jsx(g,{...a})}),e.jsx(D,{})]})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"email",children:"Адрес электронной почты"}),e.jsx(g,{id:"email",type:"email",defaultValue:s==null?void 0:s.email,disabled:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ваш адрес электронной почты не может быть изменен."})]}),e.jsx(u,{type:"submit",className:"w-fit",disabled:h||n||P,children:h?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Сохранение..."]}):"Сохранить изменения"})]})})})]}),e.jsxs(q,{children:[e.jsxs(z,{children:[e.jsx(H,{children:"Безопасность"}),e.jsx(O,{children:"Обновите свой пароль."})]}),e.jsx(_,{children:e.jsx(Q,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(B),className:"grid gap-4",children:[m&&e.jsxs(xe,{variant:"destructive",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx(fe,{children:m.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{control:c.control,name:"currentPassword",render:({field:a})=>e.jsxs(A,{children:[e.jsx(v,{children:"Текущий пароль"}),e.jsx(S,{children:e.jsx(g,{id:"current-password",type:"password",placeholder:"********",...a})}),e.jsx(D,{})]})}),e.jsx(N,{control:c.control,name:"newPassword",render:({field:a})=>e.jsxs(A,{children:[e.jsx(v,{children:"Новый пароль"}),e.jsx(S,{children:e.jsx(g,{id:"new-password",type:"password",placeholder:"********",...a})}),e.jsx(D,{})]})}),e.jsx(N,{control:c.control,name:"confirmPassword",render:({field:a})=>e.jsxs(A,{children:[e.jsx(v,{children:"Подтвердите пароль"}),e.jsx(S,{children:e.jsx(g,{id:"confirm-password",placeholder:"********",type:"password",...a})}),e.jsx(D,{})]})})]}),e.jsx(u,{type:"submit",className:"mt-2 w-fit",disabled:n||w,children:n||w?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Обновление..."]}):"Update Password"})]})})})]}),e.jsx(Ne,{})]})},is=W(Se);export{is as default,os as meta};
