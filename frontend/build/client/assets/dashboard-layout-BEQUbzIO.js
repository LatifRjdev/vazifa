import{w as On}from"./with-props-DyG_vBPJ.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{a as k,s as nt,v as $t,q as At,w as In,x as f,y as Pn,z as $n,N as An,O as zn}from"./chunk-D4RADZKF-By21buN-.js";import{A as Ke,a as Ge,b as Je}from"./avatar-B8lmOvvi.js";import{b as vt,B as A}from"./button-CYnDp3Q-.js";import{D as zt,a as Lt,b as Bt,c as Qe,d as Ln,e as wt}from"./dropdown-menu-C2T7FvO_.js";import{u as Oe}from"./auth-context-B5vrc64i.js";import{u as je}from"./language-context-DQqIPPDP.js";import{z as se,u as Ht,s as Ft,F as Ut,a as ee,b as te,c as ne,d as ae,e as re}from"./form-BmyV6FyK.js";import{t as Me}from"./index-CNgNZYQm.js";import{u as Bn}from"./useQuery-CkwzADaB.js";import{c as U,u as Vt}from"./utils-DIzSUSji.js";import{D as Hn,f as Fn}from"./DayPicker-B79OQGaG.js";import{r as Wt,P as yt,a as bt,b as jt}from"./popover-Ct-mlSgl.js";import{c as Un,a as kt}from"./index-wu72o1Zw.js";import{u as Vn}from"./Combination-BUzufNIs.js";import{u as Wn,C as qt,S as Be,a as He,b as Fe,c as Ue,d as ce}from"./select-CDLpyc4Q.js";import{u as qn}from"./index-BIYj4ebj.js";import{P as Yn}from"./index-Dspms17g.js";import{P as at}from"./index-DTIwNWd2.js";import{D as Yt,a as Xt,b as Kt,c as Gt,d as Jt,O as Xn,C as Kn,T as Gn,R as Jn,P as Qn,X as Ct}from"./dialog-Bw6wHjQP.js";import{I as Qt}from"./input-BPm_T_uW.js";import{T as rt,P as Zn,S as ea}from"./textarea-2qDDOoVt.js";import{u as ta}from"./use-task-ClqRGOoq.js";import{f as Ze,u as na,p as aa}from"./fetch-utils-CEdl9sdl.js";import{C as ra}from"./calendar-Dcbq6X4X.js";import{c as Q}from"./createLucideIcon-DYOGCEiU.js";import{B as sa}from"./bell-BXNMs8qH.js";import{S as st}from"./scroll-area-N5jEjwpk.js";import{S as Nt}from"./star-Cq7vPmKH.js";import{U as St}from"./users-C3qiH94-.js";import{C as Tt}from"./circle-check-c3MMHh6m.js";import{S as oa}from"./settings-WfLMetyi.js";import{L as ia}from"./loader-B2rr_xqw.js";import{u as la}from"./useMutation-CUJSGQ7R.js";import{w as ca}from"./schema-vgN0g95I.js";import{C as da,a as ua,b as fa,d as ma}from"./card-DunmZ-Mm.js";import{B as Re}from"./badge-BR4L36Rg.js";import"./index-BhFca_hj.js";import"./index-DgMzxt3E.js";import"./differenceInCalendarDays-D7TXt3rl.js";import"./label-URIJR8-n.js";import"./index-CnVBUu3y.js";import"./en-US-DuGUIuVI.js";import"./index-BdQq_4o_.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Rt=Q("chart-column",ha);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]],ga=Q("chevrons-left",pa);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],va=Q("chevrons-right",xa);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],Et=Q("clipboard-list",wa);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],ba=Q("languages",ya);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],ka=Q("layout-dashboard",ja);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=[["path",{d:"M11 18H3",key:"n3j2dh"}],["path",{d:"m15 18 2 2 4-4",key:"1szwhi"}],["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M16 6H3",key:"1wxfjs"}]],Na=Q("list-check",Ca);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],Ta=Q("log-out",Sa);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],Ea=Q("message-circle",Ra);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],_a=Q("user-check",Da);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]],Dt=Q("wrench",Ma),Oa=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],Ia=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],Pa=["Январ","Феврал","Март","Апрел","Май","Июн","Июл","Август","Сентябр","Октябр","Ноябр","Декабр"],$a=["Дш","Сш","Чш","Пш","Ҷм","Шн","Як"];function Aa({className:t,classNames:r,showOutsideDays:a=!0,...n}){const{language:o}=je(),s=new Date,h=o==="ru"?Oa:Pa,m=o==="ru"?Ia:$a,d={formatCaption:c=>{const u=h[c.getMonth()],l=c.getFullYear();return`${u} ${l}`},formatWeekdayName:c=>{const u=(c.getDay()+6)%7;return m[u]}};return e.jsx(Hn,{locale:Wt,showOutsideDays:a,className:U("p-3",t),formatters:d,modifiers:{today:s},modifiersStyles:{today:{backgroundColor:"hsl(var(--accent))",color:"hsl(var(--accent-foreground))",fontWeight:"bold",border:"2px solid hsl(var(--primary))",borderRadius:"6px"}},classNames:{months:"flex flex-col sm:flex-row gap-2",month:"flex flex-col gap-4",caption:"flex justify-center pt-1 relative items-center w-full",caption_label:"text-sm font-medium",nav:"flex items-center gap-1",nav_button:U(vt({variant:"outline"}),"size-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-x-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected])]:rounded-md",day:U(vt({variant:"ghost"}),"size-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start aria-selected:bg-primary aria-selected:text-primary-foreground",day_range_end:"day-range-end aria-selected:bg-primary aria-selected:text-primary-foreground",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground font-bold border-2 border-primary",day_outside:"day-outside text-muted-foreground aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...r},...n})}var Ie="Checkbox",[za,Ts]=Un(Ie),[La,ot]=za(Ie);function Ba(t){const{__scopeCheckbox:r,checked:a,children:n,defaultChecked:o,disabled:s,form:h,name:m,onCheckedChange:d,required:c,value:u="on",internal_do_not_use_render:l}=t,[p,E]=Vn({prop:a,defaultProp:o??!1,onChange:d,caller:Ie}),[_,S]=k.useState(null),[P,g]=k.useState(null),C=k.useRef(!1),O=_?!!h||!!_.closest("form"):!0,v={checked:p,disabled:s,setChecked:E,control:_,setControl:S,name:m,form:h,value:u,hasConsumerStoppedPropagationRef:C,required:c,defaultChecked:de(o)?!1:o,isFormControl:O,bubbleInput:P,setBubbleInput:g};return e.jsx(La,{scope:r,...v,children:Ha(l)?l(v):n})}var Zt="CheckboxTrigger",en=k.forwardRef(({__scopeCheckbox:t,onKeyDown:r,onClick:a,...n},o)=>{const{control:s,value:h,disabled:m,checked:d,required:c,setControl:u,setChecked:l,hasConsumerStoppedPropagationRef:p,isFormControl:E,bubbleInput:_}=ot(Zt,t),S=Vt(o,u),P=k.useRef(d);return k.useEffect(()=>{const g=s==null?void 0:s.form;if(g){const C=()=>l(P.current);return g.addEventListener("reset",C),()=>g.removeEventListener("reset",C)}},[s,l]),e.jsx(at.button,{type:"button",role:"checkbox","aria-checked":de(d)?"mixed":d,"aria-required":c,"data-state":on(d),"data-disabled":m?"":void 0,disabled:m,value:h,...n,ref:S,onKeyDown:kt(r,g=>{g.key==="Enter"&&g.preventDefault()}),onClick:kt(a,g=>{l(C=>de(C)?!0:!C),_&&E&&(p.current=g.isPropagationStopped(),p.current||g.stopPropagation())})})});en.displayName=Zt;var tn=k.forwardRef((t,r)=>{const{__scopeCheckbox:a,name:n,checked:o,defaultChecked:s,required:h,disabled:m,value:d,onCheckedChange:c,form:u,...l}=t;return e.jsx(Ba,{__scopeCheckbox:a,checked:o,defaultChecked:s,disabled:m,required:h,onCheckedChange:c,name:n,form:u,value:d,internal_do_not_use_render:({isFormControl:p})=>e.jsxs(e.Fragment,{children:[e.jsx(en,{...l,ref:r,__scopeCheckbox:a}),p&&e.jsx(sn,{__scopeCheckbox:a})]})})});tn.displayName=Ie;var nn="CheckboxIndicator",an=k.forwardRef((t,r)=>{const{__scopeCheckbox:a,forceMount:n,...o}=t,s=ot(nn,a);return e.jsx(Yn,{present:n||de(s.checked)||s.checked===!0,children:e.jsx(at.span,{"data-state":on(s.checked),"data-disabled":s.disabled?"":void 0,...o,ref:r,style:{pointerEvents:"none",...t.style}})})});an.displayName=nn;var rn="CheckboxBubbleInput",sn=k.forwardRef(({__scopeCheckbox:t,...r},a)=>{const{control:n,hasConsumerStoppedPropagationRef:o,checked:s,defaultChecked:h,required:m,disabled:d,name:c,value:u,form:l,bubbleInput:p,setBubbleInput:E}=ot(rn,t),_=Vt(a,E),S=Wn(s),P=qn(n);k.useEffect(()=>{const C=p;if(!C)return;const O=window.HTMLInputElement.prototype,z=Object.getOwnPropertyDescriptor(O,"checked").set,Y=!o.current;if(S!==s&&z){const y=new Event("click",{bubbles:Y});C.indeterminate=de(s),z.call(C,de(s)?!1:s),C.dispatchEvent(y)}},[p,S,s,o]);const g=k.useRef(de(s)?!1:s);return e.jsx(at.input,{type:"checkbox","aria-hidden":!0,defaultChecked:h??g.current,required:m,disabled:d,name:c,value:u,form:l,...r,tabIndex:-1,ref:_,style:{...r.style,...P,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});sn.displayName=rn;function Ha(t){return typeof t=="function"}function de(t){return t==="indeterminate"}function on(t){return de(t)?"indeterminate":t?"checked":"unchecked"}function Fa({className:t,...r}){return e.jsx(tn,{"data-slot":"checkbox",className:U("peer border-gray-400 dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:e.jsx(an,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(qt,{className:"size-3.5"})})})}const Ua=se.object({title:se.string().min(1,"Название обязательно"),description:se.string().optional(),status:se.enum(["To Do","In Progress","Done"]),priority:se.enum(["Low","Medium","High"]),dueDate:se.string().optional(),assignees:se.array(se.string()),responsibleManager:se.string().optional()}),Va=({open:t,onOpenChange:r,organizations:a})=>{const n=Ht({resolver:Ft(Ua),defaultValues:{title:"",description:"",status:"To Do",priority:"Medium",dueDate:"",assignees:[]}}),{data:o}=Bn({queryKey:["all-users"],queryFn:()=>Ze("/users/all"),enabled:t}),{mutate:s,isPending:h}=ta(),m=(o==null?void 0:o.users)||[],d=c=>{s({taskData:c},{onSuccess:()=>{Me.success("Задача успешно создана"),r(!1),n.reset()},onError:u=>{Me.error(u.message||"Ошибка создания задачи")}})};return e.jsx(Yt,{open:t,onOpenChange:r,children:e.jsxs(Xt,{className:"sm:max-w-[540px]",children:[e.jsx(Kt,{children:e.jsx(Gt,{children:"Создать новую задачу"})}),e.jsx(Ut,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(d),children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx(ee,{control:n.control,name:"title",render:({field:c})=>e.jsxs(te,{children:[e.jsx(ne,{children:"Название"}),e.jsx(ae,{children:e.jsx(Qt,{...c,placeholder:"Введите название задачи"})}),e.jsx(re,{})]})}),e.jsx(ee,{control:n.control,name:"description",render:({field:c})=>e.jsxs(te,{children:[e.jsx(ne,{children:"Описание"}),e.jsx(ae,{children:e.jsx(rt,{...c,placeholder:"Введите описание задачи"})}),e.jsx(re,{})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(ee,{control:n.control,name:"status",render:({field:c})=>e.jsxs(te,{children:[e.jsx(ne,{children:"Статус"}),e.jsx(ae,{children:e.jsxs(Be,{value:c.value,onValueChange:c.onChange,children:[e.jsx(He,{children:e.jsx(Fe,{placeholder:"Выберите статус"})}),e.jsxs(Ue,{children:[e.jsx(ce,{value:"To Do",children:"К выполнению"}),e.jsx(ce,{value:"In Progress",children:"В процессе"}),e.jsx(ce,{value:"Done",children:"Выполнено"})]})]})}),e.jsx(re,{})]})}),e.jsx(ee,{control:n.control,name:"priority",render:({field:c})=>e.jsxs(te,{children:[e.jsx(ne,{children:"Приоритет"}),e.jsx(ae,{children:e.jsxs(Be,{value:c.value,onValueChange:c.onChange,children:[e.jsx(He,{children:e.jsx(Fe,{placeholder:"Выберите приоритет"})}),e.jsxs(Ue,{children:[e.jsx(ce,{value:"Low",children:"Низкий"}),e.jsx(ce,{value:"Medium",children:"Средний"}),e.jsx(ce,{value:"High",children:"Высокий"})]})]})}),e.jsx(re,{})]})})]}),e.jsx(ee,{control:n.control,name:"dueDate",render:({field:c})=>e.jsxs(te,{children:[e.jsx(ne,{children:"Срок выполнения"}),e.jsx(ae,{children:e.jsxs(yt,{children:[e.jsx(bt,{asChild:!0,children:e.jsxs(A,{variant:"outline",className:"w-full justify-start text-left font-normal "+(c.value?"":"text-muted-foreground"),children:[e.jsx(ra,{className:"mr-2 h-4 w-4"}),c.value?Fn(new Date(c.value),"PPP",{locale:Wt}):e.jsx("span",{children:"Выберите дату"})]})}),e.jsx(jt,{className:"w-auto p-0",children:e.jsx(Aa,{mode:"single",selected:c.value?new Date(c.value):void 0,onSelect:u=>c.onChange(u?u.toISOString():void 0),initialFocus:!0})})]})}),e.jsx(re,{})]})}),e.jsx(ee,{control:n.control,name:"responsibleManager",render:({field:c})=>{const u=m.filter(l=>l&&["admin","manager"].includes(l.role));return e.jsxs(te,{children:[e.jsx(ne,{children:"Ответственный менеджер"}),e.jsx(ae,{children:e.jsxs(Be,{value:c.value||void 0,onValueChange:l=>{c.onChange(l==="none"?void 0:l)},children:[e.jsx(He,{children:e.jsx(Fe,{placeholder:"Выберите ответственного менеджера"})}),e.jsxs(Ue,{children:[e.jsx(ce,{value:"none",children:"Не назначен"}),u.map(l=>e.jsxs(ce,{value:l._id,children:[l.name," (",l.role==="admin"?"Админ":"Менеджер",")"]},l._id))]})]})}),e.jsx(re,{})]})}}),e.jsx(ee,{control:n.control,name:"assignees",render:({field:c})=>{const u=c.value||[];return e.jsxs(te,{children:[e.jsx(ne,{children:"Назначить участникам"}),e.jsx(ae,{children:e.jsxs(yt,{children:[e.jsx(bt,{asChild:!0,children:e.jsx(A,{variant:"outline",className:"w-full justify-start text-left font-normal min-h-11",children:u.length===0?e.jsx("span",{className:"text-muted-foreground",children:"Выберите участников"}):u.length<=2?u.map(l=>{const p=m.find(E=>E&&E._id===l);return(p==null?void 0:p.name)||"Неизвестный"}).join(", "):`Выбрано участников: ${u.length}`})}),e.jsx(jt,{className:"w-sm max-h-60 overflow-y-auto p-2",align:"start",children:e.jsx("div",{className:"flex flex-col gap-2",children:m.filter(l=>l&&l._id).map(l=>{const p=u.includes(l._id);return e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx(Fa,{checked:p,onCheckedChange:E=>{E?c.onChange([...u,l._id]):c.onChange(u.filter(_=>_!==l._id))},id:`user-${l._id}`}),e.jsx("span",{className:"truncate flex-1",children:l.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:l.role==="admin"?"Админ":l.role==="manager"?"Менеджер":"Участник"})]},l._id)})})})]})}),e.jsx(re,{})]})}})]}),e.jsxs(Jt,{children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Отмена"}),e.jsx(A,{type:"submit",disabled:h,children:h?"Создание...":"Создать задачу"})]})]})})]})})},Wa=()=>{const{language:t,setLanguage:r}=je(),a=[{code:"ru",name:"Русский",flag:"🇷🇺"},{code:"tj",name:"Тоҷикӣ",flag:"🇹🇯"}];return e.jsxs(zt,{children:[e.jsx(Lt,{asChild:!0,children:e.jsxs(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx(ba,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Переключить язык"})]})}),e.jsx(Bt,{align:"end",className:"w-40",children:a.map(n=>e.jsxs(Qe,{onClick:()=>r(n.code),className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:n.flag}),e.jsx("span",{children:n.name})]}),t===n.code&&e.jsx(qt,{className:"h-4 w-4"})]},n.code))})]})},qa=({onOrganizationSelect:t,selectedOrganization:r,onCreateOrganization:a})=>{var p;const{user:n,logout:o}=Oe(),{t:s}=je(),h=nt(),[m,d]=k.useState(!1),{organizations:c,unreadNotificationsCount:u}=$t(),l=(n==null?void 0:n.role)&&["admin","manager","super_admin"].includes(n.role);return e.jsxs("header",{className:"bg-background sticky top-0 z-40 border-b",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between px-4 sm:px-6 lg:px-8 py-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h1",{className:"text-xl font-semibold",children:s("app.name")})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wa,{}),l&&e.jsx(A,{variant:"outline",size:"sm",onClick:()=>d(!0),className:"p-2",children:e.jsx(Zn,{className:"w-4 h-4"})}),e.jsxs(A,{variant:"outline",className:"relative",onClick:()=>h("/user/notifications"),children:[e.jsx(sa,{className:"w-4 h-4"}),u>0&&e.jsx("div",{className:"absolute -top-1 right-1 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center",children:e.jsx("span",{className:"text-xs",children:u})})]}),e.jsxs(zt,{children:[e.jsx(Lt,{asChild:!0,children:e.jsx("button",{className:"rounded-full border p-1",children:e.jsxs(Ke,{className:"h-8 w-8",children:[e.jsx(Ge,{src:(n==null?void 0:n.profilePicture)||void 0,alt:(n==null?void 0:n.name)||"User"}),e.jsx(Je,{className:"bg-primary text-primary-foreground",children:((p=n==null?void 0:n.name)==null?void 0:p.charAt(0))||"U"})]})})}),e.jsxs(Bt,{align:"end",children:[e.jsx(Ln,{children:s("nav.profile")}),e.jsx(wt,{}),e.jsx(Qe,{children:e.jsx(At,{to:"/user/profile",children:s("nav.profile")})}),e.jsx(wt,{}),e.jsx(Qe,{onClick:()=>o(),children:s("nav.logout")})]})]})]})]}),l&&e.jsx(Va,{open:m,onOpenChange:d,organizations:[]})]})},Ya=({className:t,items:r,isCollapsed:a,userRole:n,...o})=>{const s=In(),h=nt(),m=r.filter(d=>d.requiresRole?n&&d.requiresRole.includes(n):!0);return e.jsx("nav",{className:U("flex flex-col space-y-2",t),...o,children:m.map(d=>{const c=d.icon,u=s.pathname===d.href,l=()=>{h(d.href)};return e.jsxs(A,{variant:u?"outline":"ghost",className:U("justify-start",u&&"bg-blue-800/20 text-blue-600 font-medium"),onClick:l,children:[c&&e.jsx(c,{className:"mr-2 h-4 w-4"}),a?e.jsx("span",{className:"sr-only",children:d.title}):d.title]},d.href)})})},Xa=({className:t})=>{const{logout:r,user:a}=Oe(),{t:n}=je(),[o,s]=k.useState(!1),m=(a==null?void 0:a.role)==="super_admin"?[{title:n("nav.important_tasks"),href:"/important-tasks",icon:Nt},{title:n("nav.all_tasks"),href:"/all-tasks",icon:Et},{title:n("nav.analytics"),href:"/analytics",icon:Rt},{title:n("nav.members"),href:"/members",icon:St},{title:n("nav.completed_tasks"),href:"/achieved",icon:Tt}]:[{title:n("nav.dashboard"),href:"/dashboard",icon:ka},{title:n("nav.my_tasks"),href:"/my-tasks",icon:Na},{title:n("nav.all_tasks"),href:"/all-tasks",icon:Et,requiresRole:["admin","manager","super_admin"]},{title:n("nav.manager_tasks"),href:"/manager-tasks",icon:_a,requiresRole:["admin","manager","super_admin"]},{title:n("nav.important_tasks"),href:"/important-tasks",icon:Nt,requiresRole:["super_admin"]},{title:n("nav.analytics"),href:"/analytics",icon:Rt,requiresRole:["admin","manager","super_admin"]},{title:n("nav.members"),href:"/members",icon:St,requiresRole:["admin","manager","super_admin"]},{title:n("nav.completed_tasks"),href:"/achieved",icon:Tt},{title:n("nav.settings"),href:"/settings",icon:oa}];return e.jsxs("div",{className:U("flex h-screen flex-col border-r bg-sidebar transition-all duration-300",o?"w-16 md:w-[80px]":"w-16 md:w-[240px]",t),children:[e.jsxs("div",{className:"flex h-14 items-center border-b px-4 mb-4",children:[e.jsxs(At,{to:"/dashboard",className:"flex items-center",children:[!o&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Dt,{className:"size-6 text-blue-600"}),e.jsx("span",{className:"font-semibold text-lg hidden md:block",children:"Vazifa"})]}),o&&e.jsx(Dt,{className:"size-6 text-blue-600"})]}),e.jsx(A,{variant:"ghost",size:"icon",className:"ml-auto hidden md:block",onClick:()=>s(!o),children:o?e.jsx(va,{className:"h-4 w-4"}):e.jsx(ga,{className:"h-4 w-4"})})]}),e.jsx(st,{className:"flex-1 px-3 py-2",children:e.jsx(Ya,{items:m,isCollapsed:o,className:U(o&&"items-center space-y-2"),userRole:a==null?void 0:a.role})}),e.jsx("div",{className:"border-t p-4 flex flex-col gap-2",children:e.jsxs(A,{variant:"ghost",size:o?"icon":"default",className:"justify-start",onClick:r,children:[e.jsx(Ta,{className:U("h-4 w-4",o?"":"mr-2")}),e.jsx("span",{className:"hidden md:block",children:!o&&n("nav.logout")})]})})]})};function Ka(t){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",r.appendChild(a),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t))}const ln=f.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),ke=()=>{const t=f.useContext(ln);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};Ka(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function Ga(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function Ja(){return it(/^Mac/)}function Qa(){return it(/^iPhone/)}function _t(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function Za(){return it(/^iPad/)||Ja()&&navigator.maxTouchPoints>1}function cn(){return Qa()||Za()}function it(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const er=24,tr=typeof window<"u"?k.useLayoutEffect:k.useEffect;function Mt(...t){return(...r)=>{for(let a of t)typeof a=="function"&&a(...r)}}const Ve=typeof document<"u"&&window.visualViewport;function Ot(t){let r=window.getComputedStyle(t);return/(auto|scroll)/.test(r.overflow+r.overflowX+r.overflowY)}function dn(t){for(Ot(t)&&(t=t.parentElement);t&&!Ot(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const nr=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let Ee=0,We;function ar(t={}){let{isDisabled:r}=t;tr(()=>{if(!r)return Ee++,Ee===1&&cn()&&(We=rr()),()=>{Ee--,Ee===0&&(We==null||We())}},[r])}function rr(){let t,r=0,a=l=>{t=dn(l.target),!(t===document.documentElement&&t===document.body)&&(r=l.changedTouches[0].pageY)},n=l=>{if(!t||t===document.documentElement||t===document.body){l.preventDefault();return}let p=l.changedTouches[0].pageY,E=t.scrollTop,_=t.scrollHeight-t.clientHeight;_!==0&&((E<=0&&p>r||E>=_&&p<r)&&l.preventDefault(),r=p)},o=l=>{let p=l.target;et(p)&&p!==document.activeElement&&(l.preventDefault(),p.style.transform="translateY(-2000px)",p.focus(),requestAnimationFrame(()=>{p.style.transform=""}))},s=l=>{let p=l.target;et(p)&&(p.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{p.style.transform="",Ve&&(Ve.height<window.innerHeight?requestAnimationFrame(()=>{It(p)}):Ve.addEventListener("resize",()=>It(p),{once:!0}))}))},h=()=>{window.scrollTo(0,0)},m=window.pageXOffset,d=window.pageYOffset,c=Mt(sr(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let u=Mt(ye(document,"touchstart",a,{passive:!1,capture:!0}),ye(document,"touchmove",n,{passive:!1,capture:!0}),ye(document,"touchend",o,{passive:!1,capture:!0}),ye(document,"focus",s,!0),ye(window,"scroll",h));return()=>{c(),u(),window.scrollTo(m,d)}}function sr(t,r,a){let n=t.style[r];return t.style[r]=a,()=>{t.style[r]=n}}function ye(t,r,a,n){return t.addEventListener(r,a,n),()=>{t.removeEventListener(r,a,n)}}function It(t){let r=document.scrollingElement||document.documentElement;for(;t&&t!==r;){let a=dn(t);if(a!==document.documentElement&&a!==document.body&&a!==t){let n=a.getBoundingClientRect().top,o=t.getBoundingClientRect().top,s=t.getBoundingClientRect().bottom;const h=a.getBoundingClientRect().bottom+er;s>h&&(a.scrollTop+=o-n)}t=a.parentElement}}function et(t){return t instanceof HTMLInputElement&&!nr.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function or(t,r){typeof t=="function"?t(r):t!=null&&(t.current=r)}function ir(...t){return r=>t.forEach(a=>or(a,r))}function un(...t){return k.useCallback(ir(...t),t)}const fn=new WeakMap;function F(t,r,a=!1){if(!t||!(t instanceof HTMLElement))return;let n={};Object.entries(r).forEach(([o,s])=>{if(o.startsWith("--")){t.style.setProperty(o,s);return}n[o]=t.style[o],t.style[o]=s}),!a&&fn.set(t,n)}function lr(t,r){if(!t||!(t instanceof HTMLElement))return;let a=fn.get(t);a&&(t.style[r]=a[r])}const L=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function De(t,r){if(!t)return null;const a=window.getComputedStyle(t),n=a.transform||a.webkitTransform||a.mozTransform;let o=n.match(/^matrix3d\((.+)\)$/);return o?parseFloat(o[1].split(", ")[L(r)?13:12]):(o=n.match(/^matrix\((.+)\)$/),o?parseFloat(o[1].split(", ")[L(r)?5:4]):null)}function cr(t){return 8*(Math.log(t+1)-2)}function qe(t,r){if(!t)return()=>{};const a=t.style.cssText;return Object.assign(t.style,r),()=>{t.style.cssText=a}}function dr(...t){return(...r)=>{for(const a of t)typeof a=="function"&&a(...r)}}const I={DURATION:.5,EASE:[.32,.72,0,1]},mn=.4,ur=.25,fr=100,hn=8,_e=16,tt=26,Ye="vaul-dragging";function pn(t){const r=f.useRef(t);return f.useEffect(()=>{r.current=t}),f.useMemo(()=>(...a)=>r.current==null?void 0:r.current.call(r,...a),[])}function mr({defaultProp:t,onChange:r}){const a=f.useState(t),[n]=a,o=f.useRef(n),s=pn(r);return f.useEffect(()=>{o.current!==n&&(s(n),o.current=n)},[n,o,s]),a}function gn({prop:t,defaultProp:r,onChange:a=()=>{}}){const[n,o]=mr({defaultProp:r,onChange:a}),s=t!==void 0,h=s?t:n,m=pn(a),d=f.useCallback(c=>{if(s){const l=typeof c=="function"?c(t):c;l!==t&&m(l)}else o(c)},[s,t,o,m]);return[h,d]}function hr({activeSnapPointProp:t,setActiveSnapPointProp:r,snapPoints:a,drawerRef:n,overlayRef:o,fadeFromIndex:s,onSnapPointChange:h,direction:m="bottom",container:d,snapToSequentialPoint:c}){const[u,l]=gn({prop:t,defaultProp:a==null?void 0:a[0],onChange:r}),[p,E]=f.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);f.useEffect(()=>{function y(){E({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]);const _=f.useMemo(()=>u===(a==null?void 0:a[a.length-1])||null,[a,u]),S=f.useMemo(()=>{var y;return(y=a==null?void 0:a.findIndex(T=>T===u))!=null?y:null},[a,u]),P=a&&a.length>0&&(s||s===0)&&!Number.isNaN(s)&&a[s]===u||!a,g=f.useMemo(()=>{const y=d?{width:d.getBoundingClientRect().width,height:d.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var T;return(T=a==null?void 0:a.map(N=>{const B=typeof N=="string";let V=0;if(B&&(V=parseInt(N,10)),L(m)){const x=B?V:p?N*y.height:0;return p?m==="bottom"?y.height-x:-y.height+x:x}const X=B?V:p?N*y.width:0;return p?m==="right"?y.width-X:-y.width+X:X}))!=null?T:[]},[a,p,d]),C=f.useMemo(()=>S!==null?g==null?void 0:g[S]:null,[g,S]),O=f.useCallback(y=>{var T;const N=(T=g==null?void 0:g.findIndex(B=>B===y))!=null?T:null;h(N),F(n.current,{transition:`transform ${I.DURATION}s cubic-bezier(${I.EASE.join(",")})`,transform:L(m)?`translate3d(0, ${y}px, 0)`:`translate3d(${y}px, 0, 0)`}),g&&N!==g.length-1&&s!==void 0&&N!==s&&N<s?F(o.current,{transition:`opacity ${I.DURATION}s cubic-bezier(${I.EASE.join(",")})`,opacity:"0"}):F(o.current,{transition:`opacity ${I.DURATION}s cubic-bezier(${I.EASE.join(",")})`,opacity:"1"}),l(a==null?void 0:a[Math.max(N,0)])},[n.current,a,g,s,o,l]);f.useEffect(()=>{if(u||t){var y;const T=(y=a==null?void 0:a.findIndex(N=>N===t||N===u))!=null?y:-1;g&&T!==-1&&typeof g[T]=="number"&&O(g[T])}},[u,t,a,g,O]);function v({draggedDistance:y,closeDrawer:T,velocity:N,dismissible:B}){if(s===void 0)return;const V=m==="bottom"||m==="right"?(C??0)-y:(C??0)+y,X=S===s-1,x=S===0,i=y>0;if(X&&F(o.current,{transition:`opacity ${I.DURATION}s cubic-bezier(${I.EASE.join(",")})`}),!c&&N>2&&!i){B?T():O(g[0]);return}if(!c&&N>2&&i&&g&&a){O(g[a.length-1]);return}const j=g==null?void 0:g.reduce((H,G)=>typeof H!="number"||typeof G!="number"?H:Math.abs(G-V)<Math.abs(H-V)?G:H),W=L(m)?window.innerHeight:window.innerWidth;if(N>mn&&Math.abs(y)<W*.4){const H=i?1:-1;if(H>0&&_&&a){O(g[a.length-1]);return}if(x&&H<0&&B&&T(),S===null)return;O(g[S+H]);return}O(j)}function z({draggedDistance:y}){if(C===null)return;const T=m==="bottom"||m==="right"?C-y:C+y;(m==="bottom"||m==="right")&&T<g[g.length-1]||(m==="top"||m==="left")&&T>g[g.length-1]||F(n.current,{transform:L(m)?`translate3d(0, ${T}px, 0)`:`translate3d(${T}px, 0, 0)`})}function Y(y,T){if(!a||typeof S!="number"||!g||s===void 0)return null;const N=S===s-1;if(S>=s&&T)return 0;if(N&&!T)return 1;if(!P&&!N)return null;const V=N?S+1:S-1,X=N?g[V]-g[V-1]:g[V+1]-g[V],x=y/Math.abs(X);return N?1-x:x}return{isLastSnapPoint:_,activeSnapPoint:u,shouldFade:P,getPercentageDragged:Y,setActiveSnapPoint:l,activeSnapPointIndex:S,onRelease:v,onDrag:z,snapPointsOffset:g}}const pr=()=>()=>{};function gr(){const{direction:t,isOpen:r,shouldScaleBackground:a,setBackgroundColorOnScale:n,noBodyStyles:o}=ke(),s=f.useRef(null),h=k.useMemo(()=>document.body.style.backgroundColor,[]);function m(){return(window.innerWidth-tt)/window.innerWidth}f.useEffect(()=>{if(r&&a){s.current&&clearTimeout(s.current);const d=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!d)return;dr(n&&!o?qe(document.body,{background:"black"}):pr,qe(d,{transformOrigin:L(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${I.DURATION}s`,transitionTimingFunction:`cubic-bezier(${I.EASE.join(",")})`}));const c=qe(d,{borderRadius:`${hn}px`,overflow:"hidden",...L(t)?{transform:`scale(${m()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${m()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{c(),s.current=window.setTimeout(()=>{h?document.body.style.background=h:document.body.style.removeProperty("background")},I.DURATION*1e3)}}},[r,a,h])}let be=null;function xr({isOpen:t,modal:r,nested:a,hasBeenOpened:n,preventScrollRestoration:o,noBodyStyles:s}){const[h,m]=f.useState(()=>typeof window<"u"?window.location.href:""),d=f.useRef(0),c=f.useCallback(()=>{if(_t()&&be===null&&t&&!s){be={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:l,innerHeight:p}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-d.current}px`,left:`${-l}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const E=p-window.innerHeight;E&&d.current>=p&&(document.body.style.top=`${-(d.current+E)}px`)}),300)}},[t]),u=f.useCallback(()=>{if(_t()&&be!==null&&!s){const l=-parseInt(document.body.style.top,10),p=-parseInt(document.body.style.left,10);Object.assign(document.body.style,be),window.requestAnimationFrame(()=>{if(o&&h!==window.location.href){m(window.location.href);return}window.scrollTo(p,l)}),be=null}},[h]);return f.useEffect(()=>{function l(){d.current=window.scrollY}return l(),window.addEventListener("scroll",l),()=>{window.removeEventListener("scroll",l)}},[]),f.useEffect(()=>{if(r)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||u()}},[r,u]),f.useEffect(()=>{a||!n||(t?(!window.matchMedia("(display-mode: standalone)").matches&&c(),r||window.setTimeout(()=>{u()},500)):u())},[t,n,h,r,a,c,u]),{restorePositionSetting:u}}function vr({open:t,onOpenChange:r,children:a,onDrag:n,onRelease:o,snapPoints:s,shouldScaleBackground:h=!1,setBackgroundColorOnScale:m=!0,closeThreshold:d=ur,scrollLockTimeout:c=fr,dismissible:u=!0,handleOnly:l=!1,fadeFromIndex:p=s&&s.length-1,activeSnapPoint:E,setActiveSnapPoint:_,fixed:S,modal:P=!0,onClose:g,nested:C,noBodyStyles:O=!1,direction:v="bottom",defaultOpen:z=!1,disablePreventScroll:Y=!0,snapToSequentialPoint:y=!1,preventScrollRestoration:T=!1,repositionInputs:N=!0,onAnimationEnd:B,container:V,autoFocus:X=!1}){var x,i;const[j=!1,W]=gn({defaultProp:z,prop:t,onChange:w=>{r==null||r(w),!w&&!C&&Nn(),setTimeout(()=>{B==null||B(w)},I.DURATION*1e3),w&&!P&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),w||(document.body.style.pointerEvents="auto")}}),[H,G]=f.useState(!1),[oe,pe]=f.useState(!1),[wn,lt]=f.useState(!1),fe=f.useRef(null),Ne=f.useRef(null),Pe=f.useRef(null),$e=f.useRef(null),ge=f.useRef(null),xe=f.useRef(!1),Ae=f.useRef(null),ze=f.useRef(0),me=f.useRef(!1),ct=f.useRef(!z),dt=f.useRef(0),b=f.useRef(null),ut=f.useRef(((x=b.current)==null?void 0:x.getBoundingClientRect().height)||0),ft=f.useRef(((i=b.current)==null?void 0:i.getBoundingClientRect().width)||0),Le=f.useRef(0),yn=f.useCallback(w=>{s&&w===ve.length-1&&(Ne.current=new Date)},[]),{activeSnapPoint:bn,activeSnapPointIndex:he,setActiveSnapPoint:mt,onRelease:jn,snapPointsOffset:ve,onDrag:kn,shouldFade:ht,getPercentageDragged:Cn}=hr({snapPoints:s,activeSnapPointProp:E,setActiveSnapPointProp:_,drawerRef:b,fadeFromIndex:p,overlayRef:fe,onSnapPointChange:yn,direction:v,container:V,snapToSequentialPoint:y});ar({isDisabled:!j||oe||!P||wn||!H||!N||!Y});const{restorePositionSetting:Nn}=xr({isOpen:j,modal:P,nested:C??!1,hasBeenOpened:H,preventScrollRestoration:T,noBodyStyles:O});function Se(){return(window.innerWidth-tt)/window.innerWidth}function Sn(w){var D,M;!u&&!s||b.current&&!b.current.contains(w.target)||(ut.current=((D=b.current)==null?void 0:D.getBoundingClientRect().height)||0,ft.current=((M=b.current)==null?void 0:M.getBoundingClientRect().width)||0,pe(!0),Pe.current=new Date,cn()&&window.addEventListener("touchend",()=>xe.current=!1,{once:!0}),w.target.setPointerCapture(w.pointerId),ze.current=L(v)?w.pageY:w.pageX)}function pt(w,D){var M;let R=w;const $=(M=window.getSelection())==null?void 0:M.toString(),K=b.current?De(b.current,v):null,q=new Date;if(R.tagName==="SELECT"||R.hasAttribute("data-vaul-no-drag")||R.closest("[data-vaul-no-drag]"))return!1;if(v==="right"||v==="left")return!0;if(Ne.current&&q.getTime()-Ne.current.getTime()<500)return!1;if(K!==null&&(v==="bottom"?K>0:K<0))return!0;if($&&$.length>0)return!1;if(ge.current&&q.getTime()-ge.current.getTime()<c&&K===0||D)return ge.current=q,!1;for(;R;){if(R.scrollHeight>R.clientHeight){if(R.scrollTop!==0)return ge.current=new Date,!1;if(R.getAttribute("role")==="dialog")return!0}R=R.parentNode}return!0}function Tn(w){if(b.current&&oe){const D=v==="bottom"||v==="right"?1:-1,M=(ze.current-(L(v)?w.pageY:w.pageX))*D,R=M>0,$=s&&!u&&!R;if($&&he===0)return;const K=Math.abs(M),q=document.querySelector("[data-vaul-drawer-wrapper]"),ie=v==="bottom"||v==="top"?ut.current:ft.current;let J=K/ie;const ue=Cn(K,R);if(ue!==null&&(J=ue),$&&J>=1||!xe.current&&!pt(w.target,R))return;if(b.current.classList.add(Ye),xe.current=!0,F(b.current,{transition:"none"}),F(fe.current,{transition:"none"}),s&&kn({draggedDistance:M}),R&&!s){const Z=cr(M),Te=Math.min(Z*-1,0)*D;F(b.current,{transform:L(v)?`translate3d(0, ${Te}px, 0)`:`translate3d(${Te}px, 0, 0)`});return}const le=1-J;if((ht||p&&he===p-1)&&(n==null||n(w,J),F(fe.current,{opacity:`${le}`,transition:"none"},!0)),q&&fe.current&&h){const Z=Math.min(Se()+J*(1-Se()),1),Te=8-J*8,xt=Math.max(0,14-J*14);F(q,{borderRadius:`${Te}px`,transform:L(v)?`scale(${Z}) translate3d(0, ${xt}px, 0)`:`scale(${Z}) translate3d(${xt}px, 0, 0)`,transition:"none"},!0)}if(!s){const Z=K*D;F(b.current,{transform:L(v)?`translate3d(0, ${Z}px, 0)`:`translate3d(${Z}px, 0, 0)`})}}}f.useEffect(()=>{window.requestAnimationFrame(()=>{ct.current=!0})},[]),f.useEffect(()=>{var w;function D(){if(!b.current||!N)return;const M=document.activeElement;if(et(M)||me.current){var R;const $=((R=window.visualViewport)==null?void 0:R.height)||0,K=window.innerHeight;let q=K-$;const ie=b.current.getBoundingClientRect().height||0,J=ie>K*.8;Le.current||(Le.current=ie);const ue=b.current.getBoundingClientRect().top;if(Math.abs(dt.current-q)>60&&(me.current=!me.current),s&&s.length>0&&ve&&he){const le=ve[he]||0;q+=le}if(dt.current=q,ie>$||me.current){const le=b.current.getBoundingClientRect().height;let Z=le;le>$&&(Z=$-(J?ue:tt)),S?b.current.style.height=`${le-Math.max(q,0)}px`:b.current.style.height=`${Math.max(Z,$-ue)}px`}else Ga()||(b.current.style.height=`${Le.current}px`);s&&s.length>0&&!me.current?b.current.style.bottom="0px":b.current.style.bottom=`${Math.max(q,0)}px`}}return(w=window.visualViewport)==null||w.addEventListener("resize",D),()=>{var M;return(M=window.visualViewport)==null?void 0:M.removeEventListener("resize",D)}},[he,s,ve]);function we(w){Rn(),g==null||g(),w||W(!1),setTimeout(()=>{s&&mt(s[0])},I.DURATION*1e3)}function gt(){if(!b.current)return;const w=document.querySelector("[data-vaul-drawer-wrapper]"),D=De(b.current,v);F(b.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${I.DURATION}s cubic-bezier(${I.EASE.join(",")})`}),F(fe.current,{transition:`opacity ${I.DURATION}s cubic-bezier(${I.EASE.join(",")})`,opacity:"1"}),h&&D&&D>0&&j&&F(w,{borderRadius:`${hn}px`,overflow:"hidden",...L(v)?{transform:`scale(${Se()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Se()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${I.DURATION}s`,transitionTimingFunction:`cubic-bezier(${I.EASE.join(",")})`},!0)}function Rn(){!oe||!b.current||(b.current.classList.remove(Ye),xe.current=!1,pe(!1),$e.current=new Date)}function En(w){if(!oe||!b.current)return;b.current.classList.remove(Ye),xe.current=!1,pe(!1),$e.current=new Date;const D=De(b.current,v);if(!w||!pt(w.target,!1)||!D||Number.isNaN(D)||Pe.current===null)return;const M=$e.current.getTime()-Pe.current.getTime(),R=ze.current-(L(v)?w.pageY:w.pageX),$=Math.abs(R)/M;if($>.05&&(lt(!0),setTimeout(()=>{lt(!1)},200)),s){jn({draggedDistance:R*(v==="bottom"||v==="right"?1:-1),closeDrawer:we,velocity:$,dismissible:u}),o==null||o(w,!0);return}if(v==="bottom"||v==="right"?R>0:R<0){gt(),o==null||o(w,!0);return}if($>mn){we(),o==null||o(w,!1);return}var K;const q=Math.min((K=b.current.getBoundingClientRect().height)!=null?K:0,window.innerHeight);var ie;const J=Math.min((ie=b.current.getBoundingClientRect().width)!=null?ie:0,window.innerWidth),ue=v==="left"||v==="right";if(Math.abs(D)>=(ue?J:q)*d){we(),o==null||o(w,!1);return}o==null||o(w,!0),gt()}f.useEffect(()=>(j&&(F(document.documentElement,{scrollBehavior:"auto"}),Ne.current=new Date),()=>{lr(document.documentElement,"scrollBehavior")}),[j]);function Dn(w){const D=w?(window.innerWidth-_e)/window.innerWidth:1,M=w?-16:0;Ae.current&&window.clearTimeout(Ae.current),F(b.current,{transition:`transform ${I.DURATION}s cubic-bezier(${I.EASE.join(",")})`,transform:L(v)?`scale(${D}) translate3d(0, ${M}px, 0)`:`scale(${D}) translate3d(${M}px, 0, 0)`}),!w&&b.current&&(Ae.current=setTimeout(()=>{const R=De(b.current,v);F(b.current,{transition:"none",transform:L(v)?`translate3d(0, ${R}px, 0)`:`translate3d(${R}px, 0, 0)`})},500))}function _n(w,D){if(D<0)return;const M=(window.innerWidth-_e)/window.innerWidth,R=M+D*(1-M),$=-16+D*_e;F(b.current,{transform:L(v)?`scale(${R}) translate3d(0, ${$}px, 0)`:`scale(${R}) translate3d(${$}px, 0, 0)`,transition:"none"})}function Mn(w,D){const M=L(v)?window.innerHeight:window.innerWidth,R=D?(M-_e)/M:1,$=D?-16:0;D&&F(b.current,{transition:`transform ${I.DURATION}s cubic-bezier(${I.EASE.join(",")})`,transform:L(v)?`scale(${R}) translate3d(0, ${$}px, 0)`:`scale(${R}) translate3d(${$}px, 0, 0)`})}return f.useEffect(()=>{P||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[P]),f.createElement(Jn,{defaultOpen:z,onOpenChange:w=>{!u&&!w||(w?G(!0):we(!0),W(w))},open:j},f.createElement(ln.Provider,{value:{activeSnapPoint:bn,snapPoints:s,setActiveSnapPoint:mt,drawerRef:b,overlayRef:fe,onOpenChange:r,onPress:Sn,onRelease:En,onDrag:Tn,dismissible:u,shouldAnimate:ct,handleOnly:l,isOpen:j,isDragging:oe,shouldFade:ht,closeDrawer:we,onNestedDrag:_n,onNestedOpenChange:Dn,onNestedRelease:Mn,keyboardIsOpen:me,modal:P,snapPointsOffset:ve,activeSnapPointIndex:he,direction:v,shouldScaleBackground:h,setBackgroundColorOnScale:m,noBodyStyles:O,container:V,autoFocus:X}},a))}const xn=f.forwardRef(function({...t},r){const{overlayRef:a,snapPoints:n,onRelease:o,shouldFade:s,isOpen:h,modal:m,shouldAnimate:d}=ke(),c=un(r,a),u=n&&n.length>0;if(!m)return null;const l=f.useCallback(p=>o(p),[o]);return f.createElement(Xn,{onMouseUp:l,ref:c,"data-vaul-overlay":"","data-vaul-snap-points":h&&u?"true":"false","data-vaul-snap-points-overlay":h&&s?"true":"false","data-vaul-animate":d!=null&&d.current?"true":"false",...t})});xn.displayName="Drawer.Overlay";const vn=f.forwardRef(function({onPointerDownOutside:t,style:r,onOpenAutoFocus:a,...n},o){const{drawerRef:s,onPress:h,onRelease:m,onDrag:d,keyboardIsOpen:c,snapPointsOffset:u,activeSnapPointIndex:l,modal:p,isOpen:E,direction:_,snapPoints:S,container:P,handleOnly:g,shouldAnimate:C,autoFocus:O}=ke(),[v,z]=f.useState(!1),Y=un(o,s),y=f.useRef(null),T=f.useRef(null),N=f.useRef(!1),B=S&&S.length>0;gr();const V=(x,i,j=0)=>{if(N.current)return!0;const W=Math.abs(x.y),H=Math.abs(x.x),G=H>W,oe=["bottom","right"].includes(i)?1:-1;if(i==="left"||i==="right"){if(!(x.x*oe<0)&&H>=0&&H<=j)return G}else if(!(x.y*oe<0)&&W>=0&&W<=j)return!G;return N.current=!0,!0};f.useEffect(()=>{B&&window.requestAnimationFrame(()=>{z(!0)})},[]);function X(x){y.current=null,N.current=!1,m(x)}return f.createElement(Kn,{"data-vaul-drawer-direction":_,"data-vaul-drawer":"","data-vaul-delayed-snap-points":v?"true":"false","data-vaul-snap-points":E&&B?"true":"false","data-vaul-custom-container":P?"true":"false","data-vaul-animate":C!=null&&C.current?"true":"false",...n,ref:Y,style:u&&u.length>0?{"--snap-point-height":`${u[l??0]}px`,...r}:r,onPointerDown:x=>{g||(n.onPointerDown==null||n.onPointerDown.call(n,x),y.current={x:x.pageX,y:x.pageY},h(x))},onOpenAutoFocus:x=>{a==null||a(x),O||x.preventDefault()},onPointerDownOutside:x=>{if(t==null||t(x),!p||x.defaultPrevented){x.preventDefault();return}c.current&&(c.current=!1)},onFocusOutside:x=>{if(!p){x.preventDefault();return}},onPointerMove:x=>{if(T.current=x,g||(n.onPointerMove==null||n.onPointerMove.call(n,x),!y.current))return;const i=x.pageY-y.current.y,j=x.pageX-y.current.x,W=x.pointerType==="touch"?10:2;V({x:j,y:i},_,W)?d(x):(Math.abs(j)>W||Math.abs(i)>W)&&(y.current=null)},onPointerUp:x=>{n.onPointerUp==null||n.onPointerUp.call(n,x),y.current=null,N.current=!1,m(x)},onPointerOut:x=>{n.onPointerOut==null||n.onPointerOut.call(n,x),X(T.current)},onContextMenu:x=>{n.onContextMenu==null||n.onContextMenu.call(n,x),T.current&&X(T.current)}})});vn.displayName="Drawer.Content";const wr=250,yr=120,br=f.forwardRef(function({preventCycle:t=!1,children:r,...a},n){const{closeDrawer:o,isDragging:s,snapPoints:h,activeSnapPoint:m,setActiveSnapPoint:d,dismissible:c,handleOnly:u,isOpen:l,onPress:p,onDrag:E}=ke(),_=f.useRef(null),S=f.useRef(!1);function P(){if(S.current){O();return}window.setTimeout(()=>{g()},yr)}function g(){if(s||t||S.current){O();return}if(O(),!h||h.length===0){c||o();return}if(m===h[h.length-1]&&c){o();return}const z=h.findIndex(y=>y===m);if(z===-1)return;const Y=h[z+1];d(Y)}function C(){_.current=window.setTimeout(()=>{S.current=!0},wr)}function O(){_.current&&window.clearTimeout(_.current),S.current=!1}return f.createElement("div",{onClick:P,onPointerCancel:O,onPointerDown:v=>{u&&p(v),C()},onPointerMove:v=>{u&&E(v)},ref:n,"data-vaul-drawer-visible":l?"true":"false","data-vaul-handle":"","aria-hidden":"true",...a},f.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},r))});br.displayName="Drawer.Handle";function jr(t){const r=ke(),{container:a=r.container,...n}=t;return f.createElement(Qn,{container:a,...n})}const Ce={Root:vr,Content:vn,Overlay:xn,Portal:jr,Title:Gn};function kr({...t}){return e.jsx(Ce.Root,{"data-slot":"drawer",...t})}function Cr({...t}){return e.jsx(Ce.Portal,{"data-slot":"drawer-portal",...t})}function Nr({className:t,...r}){return e.jsx(Ce.Overlay,{"data-slot":"drawer-overlay",className:U("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...r})}function Sr({className:t,children:r,...a}){return e.jsxs(Cr,{"data-slot":"drawer-portal",children:[e.jsx(Nr,{}),e.jsxs(Ce.Content,{"data-slot":"drawer-content",className:U("group/drawer-content bg-background fixed z-50 flex h-auto flex-col","data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b","data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t","data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm","data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",t),...a,children:[e.jsx("div",{className:"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block"}),r]})]})}function Tr({className:t,...r}){return e.jsx("div",{"data-slot":"drawer-header",className:U("flex flex-col gap-1.5 p-4",t),...r})}function Rr({className:t,...r}){return e.jsx(Ce.Title,{"data-slot":"drawer-title",className:U("text-foreground font-semibold",t),...r})}const Xe=768;function Er(){const[t,r]=k.useState(void 0);return k.useEffect(()=>{const a=window.matchMedia(`(max-width: ${Xe-1}px)`),n=()=>{r(window.innerWidth<Xe)};return a.addEventListener("change",n),r(window.innerWidth<Xe),()=>a.removeEventListener("change",n)},[]),!!t}const Dr=({open:t,onOpenChange:r,title:a,children:n})=>Er()?e.jsx(kr,{open:t,onOpenChange:r,modal:!1,children:e.jsxs(Sr,{className:"px-2 py-6 max-h-[90vh]",children:[e.jsx(Tr,{className:"px-4",children:e.jsx(Rr,{className:"text-left",children:a})}),e.jsx(st,{className:"h-full overflow-y-auto hide-scrollbar",children:n})]})}):e.jsx(Yt,{open:t,onOpenChange:r,modal:!0,children:e.jsxs(Xt,{className:"max-h-[80vh] overflow-y-auto hide-scrollbar",children:[e.jsx(Kt,{children:e.jsx(Gt,{children:a})}),n]})}),_r=["workspaces"],Mr=()=>{const t=na();return la({mutationFn:r=>aa("/workspaces",r),onSuccess:()=>{t.invalidateQueries({queryKey:_r})}})},Pt=["#FF5733","#33C1FF","#28A745","#FFC300","#8E44AD","#E67E22","#2ECC71","#34495E"],Or=({isCreateWorkspaceOpen:t,setIsCreateWorkspaceOpen:r})=>{const a=Ht({resolver:Ft(ca),defaultValues:{name:"",color:Pt[0]}}),n=Pn(),o=nt(),{mutate:s,isPending:h}=Mr(),m=d=>{s(d,{onSuccess:c=>{n.revalidate(),Me.success("Рабочая область успешно создана"),a.reset(),r(!1),o("/dashboard")},onError:()=>{Me.error("Failed to create workspace")}})};return e.jsx(Dr,{open:t,onOpenChange:r,title:"Создать новое рабочее пространство",children:e.jsx(Ut,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(m),className:"px-4 md:px-0",children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx(ee,{control:a.control,name:"name",render:({field:d})=>e.jsxs(te,{children:[e.jsx(ne,{children:"Имя рабочей области"}),e.jsx(ae,{children:e.jsx(Qt,{...d,placeholder:"Название рабочего пространства"})}),e.jsx(re,{})]})}),e.jsx(ee,{control:a.control,name:"description",render:({field:d})=>e.jsxs(te,{children:[e.jsx(ne,{children:"Описание рабочей области"}),e.jsx(ae,{children:e.jsx(rt,{...d,placeholder:"Описание рабочего пространства (необязательно)"})}),e.jsx(re,{})]})}),e.jsx(ee,{control:a.control,name:"color",render:({field:d})=>e.jsxs(te,{children:[e.jsx(ne,{children:"Цвет рабочей области"}),e.jsx(ae,{children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:Pt.map(c=>e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:c,checked:d.value===c,onChange:()=>d.onChange(c),className:"hidden"}),e.jsx("span",{className:`w-7 h-7 rounded-full border-2 border-gray-300 flex items-center justify-center transition-all duration-200 transform hover:scale-110 hover:shadow-lg ${d.value===c?"ring-2 ring-offset-2 ring-blue-500 border-blue-500":""}`,style:{backgroundColor:c},children:d.value===c&&e.jsx("span",{className:"w-3 h-3 bg-white rounded-full block"})})]},c))})}),e.jsx(re,{})]})})]}),e.jsxs(Jt,{className:"mt-6 md:mt-0",children:[e.jsx(A,{disabled:h,variant:"outline",onClick:()=>r(!1),children:"Отмена"}),e.jsx(A,{type:"submit",disabled:h,children:h?"Создание...":"Создать"})]})]})})})},Ir=({className:t})=>{const{user:r}=Oe(),{t:a}=je(),[n,o]=k.useState(!1),[s,h]=k.useState([]),[m,d]=k.useState(""),[c,u]=k.useState(0),[l,p]=k.useState([]),[E,_]=k.useState(null),[S,P]=k.useState(!1),[g,C]=k.useState(null),O=k.useRef(null);if(!r||!r._id||!r.role||!["admin","super_admin"].includes(r.role))return null;const v=()=>{var i;(i=O.current)==null||i.scrollIntoView({behavior:"smooth"})};k.useEffect(()=>{n&&(z(),y(),v())},[n]),k.useEffect(()=>{Y();const i=setInterval(Y,3e4);return()=>clearInterval(i)},[]),k.useEffect(()=>{if(n){const i=setInterval(()=>{z(),y()},3e3);return()=>clearInterval(i)}},[n]),k.useEffect(()=>{v()},[s]);const z=async()=>{try{const i=await fetch("/api-v1/admin-messages",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(i.ok){const j=await i.json();h(j.messages)}}catch(i){console.error("Error fetching messages:",i)}},Y=async()=>{try{const i=await fetch("/api-v1/admin-messages/unread-count",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(i.ok){const j=await i.json();u(j.unreadCount)}}catch(i){console.error("Error fetching unread count:",i)}},y=async()=>{try{const i=await fetch("/api-v1/admin-messages/online-admins",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(i.ok){const j=await i.json();p(j.admins)}}catch(i){console.error("Error fetching online admins:",i)}},T=async()=>{if(m.trim()){P(!0);try{const i={message:m,messageType:E?"direct":"broadcast",recipient:E,priority:"normal",language:"ru"};g?(await fetch(`/api-v1/admin-messages/${g._id}/reply`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({message:m,priority:"normal",language:"ru"})})).ok&&(d(""),C(null),z()):(await fetch("/api-v1/admin-messages",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(i)})).ok&&(d(""),z(),Y())}catch(i){console.error("Error sending message:",i)}finally{P(!1)}}},N=async i=>{try{await fetch(`/api-v1/admin-messages/${i}/read`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),z(),Y()}catch(j){console.error("Error marking message as read:",j)}},B=async(i,j)=>{try{await fetch(`/api-v1/admin-messages/${i}/reaction`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({emoji:j})}),z()}catch(W){console.error("Error adding reaction:",W)}},V=i=>new Date(i).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),X=i=>{switch(i){case"urgent":return"bg-red-500";case"high":return"bg-orange-500";case"normal":return"bg-blue-500";case"low":return"bg-gray-500";default:return"bg-blue-500"}},x=i=>i.split(" ").map(j=>j[0]).join("").toUpperCase();return e.jsxs("div",{className:U("fixed bottom-4 right-4 z-50",t),children:[!n&&e.jsxs(A,{onClick:()=>o(!0),className:"relative h-12 w-12 sm:h-14 sm:w-14 rounded-full bg-blue-600 hover:bg-blue-700 shadow-lg",children:[e.jsx(Ea,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"}),c>0&&e.jsx(Re,{className:"absolute -top-1 -right-1 sm:-top-2 sm:-right-2 h-5 w-5 sm:h-6 sm:w-6 rounded-full bg-red-500 text-xs text-white p-0 flex items-center justify-center",children:c>99?"99+":c})]}),n&&e.jsxs(da,{className:"w-[calc(100vw-2rem)] max-w-96 h-[calc(100vh-2rem)] max-h-[600px] shadow-2xl",children:[e.jsxs(ua,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(fa,{className:"text-lg font-semibold",children:"Админ чат"}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>o(!1),children:e.jsx(Ct,{className:"h-4 w-4"})})]}),e.jsxs(ma,{className:"p-0 flex flex-col h-[calc(600px-80px)]",children:[e.jsxs("div",{className:"p-3 border-b",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Онлайн админы"}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto",children:[e.jsx(A,{variant:E===null?"default":"outline",size:"sm",onClick:()=>_(null),children:"Всем"}),l.filter(i=>i._id!==(r==null?void 0:r._id)).map(i=>e.jsxs(A,{variant:E===i._id?"default":"outline",size:"sm",onClick:()=>_(i._id),className:"flex items-center gap-1 whitespace-nowrap",children:[e.jsx("div",{className:U("w-2 h-2 rounded-full",i.isOnline?"bg-green-500":"bg-gray-400")}),i.name]},i._id))]})]}),e.jsx(st,{className:"flex-1 p-3",children:e.jsxs("div",{className:"space-y-4",children:[s.map(i=>{const j=i.sender._id===(r==null?void 0:r._id);return!j&&!i.isRead&&N(i._id),e.jsxs("div",{className:U("flex gap-2",j?"justify-end":"justify-start"),children:[!j&&e.jsxs(Ke,{className:"h-8 w-8",children:[e.jsx(Ge,{src:i.sender.profilePicture}),e.jsx(Je,{className:"text-xs",children:x(i.sender.name)})]}),e.jsxs("div",{className:U("max-w-[70%] space-y-1",j?"items-end":"items-start"),children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[!j&&e.jsx("span",{className:"font-medium",children:i.sender.name}),e.jsx(Re,{variant:"secondary",className:"text-xs px-1 py-0",children:i.sender.role==="super_admin"?"Супер админ":"Админ"}),e.jsx("span",{children:V(i.createdAt)})]}),i.replyTo&&e.jsxs("div",{className:"text-xs text-gray-500 bg-gray-100 p-2 rounded border-l-2 border-blue-500",children:[e.jsxs("div",{className:"font-medium",children:[i.replyTo.sender.name,":"]}),e.jsx("div",{className:"truncate",children:i.replyTo.message})]}),e.jsxs("div",{className:U("rounded-lg px-3 py-2 text-sm relative group",j?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[i.priority!=="normal"&&e.jsx("div",{className:U("absolute -top-1 -left-1 w-3 h-3 rounded-full",X(i.priority))}),e.jsx("div",{className:"break-words",children:i.message}),i.isEdited&&e.jsx("div",{className:"text-xs opacity-70 mt-1",children:"изменено"}),e.jsxs("div",{className:"absolute -top-8 right-0 hidden group-hover:flex bg-white border rounded shadow-sm",children:[e.jsx(A,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>C(i),children:"↩️"}),e.jsx(A,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>B(i._id,"👍"),children:"👍"}),e.jsx(A,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>B(i._id,"❤️"),children:"❤️"})]})]}),i.reactions.length>0&&e.jsx("div",{className:"flex gap-1",children:i.reactions.map((H,G)=>e.jsx(Re,{variant:"secondary",className:"text-xs px-1 py-0 cursor-pointer",onClick:()=>B(i._id,H.emoji),children:H.emoji},G))}),i.messageType==="broadcast"&&e.jsx(Re,{variant:"outline",className:"text-xs",children:"Всем"})]}),j&&e.jsxs(Ke,{className:"h-8 w-8",children:[e.jsx(Ge,{src:i.sender.profilePicture}),e.jsx(Je,{className:"text-xs",children:x(i.sender.name)})]})]},i._id)}),e.jsx("div",{ref:O})]})}),g&&e.jsxs("div",{className:"p-2 bg-blue-50 border-t flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:["Отвечаете ",g.sender.name,":"]}),e.jsx("div",{className:"text-gray-600 truncate",children:g.message})]}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>C(null),children:e.jsx(Ct,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"p-3 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(rt,{value:m,onChange:i=>d(i.target.value),placeholder:E?"Напишите личное сообщение...":"Напишите сообщение всем...",className:"min-h-[40px] max-h-[120px] resize-none",onKeyDown:i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),T())}}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx(A,{size:"sm",onClick:T,disabled:!m.trim()||S,className:"h-10 w-10 p-0",children:e.jsx(ea,{className:"h-4 w-4"})})})]})})]})]})]})},Rs=async()=>{try{const[t,r]=await Promise.all([Ze("/users/notifications/unread-count"),Ze("/tasks/my-tasks")]);return{organizations:[],unreadNotificationsCount:t,myTasks:r}}catch{return $n("/sign-in")}},Pr=()=>{const{isAuthenticated:t,isLoading:r}=Oe(),[a,n]=k.useState(!1),{organizations:o}=$t(),[s,h]=k.useState(null);if(k.useEffect(()=>{!s&&o&&o.length>0&&h(o[0])},[s,o]),r)return e.jsx(ia,{message:"Loading..."});if(!t)return e.jsx(An,{to:"/sign-in",replace:!0});const m=d=>{h(d)};return e.jsxs("div",{className:"flex h-screen w-full overflow-hidden",children:[e.jsx(Xa,{className:"flex-shrink-0"}),e.jsxs("div",{className:"flex-1 flex flex-col h-screen min-w-0",children:[e.jsx(qa,{onOrganizationSelect:m,selectedOrganization:s,onCreateOrganization:()=>n(!0)}),e.jsx("main",{className:"flex-1 overflow-y-auto min-h-0",children:e.jsx("div",{className:"container mx-auto px-2 sm:px-4 lg:px-6 xl:px-8 py-2 sm:py-4 lg:py-6 xl:py-8 w-full",children:e.jsx(zn,{})})})]}),e.jsx(Or,{isCreateWorkspaceOpen:a,setIsCreateWorkspaceOpen:n}),e.jsx(Ir,{})]})},Es=On(Pr);export{Rs as clientLoader,Es as default};
