import{w as c}from"./with-props-DyG_vBPJ.js";import{j as a}from"./jsx-runtime-D_zvdyIk.js";import{s as m,t as u,a as l}from"./chunk-D4RADZKF-By21buN-.js";import{t}from"./index-CNgNZYQm.js";import{L as p}from"./loader-B2rr_xqw.js";import{u as h}from"./auth-context-B5vrc64i.js";import"./index-CnVBUu3y.js";import"./fetch-utils-CEdl9sdl.js";import"./index-DgMzxt3E.js";import"./differenceInCalendarDays-D7TXt3rl.js";function N(){return[{title:"Vazifa | OAuth Callback"},{name:"description",content:"Processing OAuth authentication..."}]}const f=()=>{const r=m(),[o]=u(),{login:n}=h();return l.useEffect(()=>{const s=o.get("token");if(o.get("error")){t.error("Ошибка аутентификации. Попробуйте снова."),r("/sign-in");return}if(s)try{const i=JSON.parse(atob(s.split(".")[1]));fetch("https://api.vazifa.online/api-v1/users/me",{headers:{Authorization:`Bearer ${s}`}}).then(e=>e.json()).then(e=>{if(e.user)n({user:e.user,token:s}),t.success("Успешный вход через OAuth!"),r("/dashboard");else throw new Error("Invalid user data")}).catch(e=>{console.error("OAuth callback error:",e),t.error("Ошибка при получении данных пользователя"),r("/sign-in")})}catch(i){console.error("Token parsing error:",i),t.error("Неверный токен аутентификации"),r("/sign-in")}else t.error("Токен аутентификации не найден"),r("/sign-in")},[o,r,n]),a.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-muted/40 p-4",children:[a.jsx(p,{message:"Обработка аутентификации..."}),a.jsx("p",{className:"mt-4 text-muted-foreground text-center",children:"Пожалуйста, подождите, пока мы завершаем процесс входа..."})]})},P=c(f);export{P as default,N as meta};
